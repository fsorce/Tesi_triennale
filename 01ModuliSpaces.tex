\chapter{Moduli Spaces}

In this chapter we introduce the basic category theory used in the study of moduli spaces. After a quick review of the Yoneda embedding, we define representability of a functor and give the definition of fine and coarse moduli space. After that we give a quick overview of Zariski sheaves and prove representability results that we will need in the third chapter.\medskip

We adopt the following conventions:
\begin{itemize}
\item All categories considered in this document will be small.
\item If $\Cc$ is a category, we shall write $X\in \Cc$ to mean ``$X$ is an object in $\Cc$".
\item If $A,B\in \Cc$, we denote the set of morphisms from $A$ to $B$ with $\Hom(A,B)$ or $\Hom_\Cc(A,B)$ for specificity.
\item If $A$ and $B$ are $R$-modules we write $\Hom_R(A,B)$ instead of $\Hom_{R\text{-Mod}}(A,B)$.
\end{itemize}
Most definitions given in this chapter follow section 0.3 of \cite{Alper}.


\section{Yoneda lemma}
\begin{definition}[Presheaf]
A contravariant functor $F:\Cc\op\to \Set$ is called a \textbf{presheaf} on $\Cc$. If $T\in \Cc$ then we call the elements of $F(T)$ \textbf{families} over $T$.
\end{definition}
\begin{definition}[Presheaf category]
For any fixed category $\Cc$, the presheaves on $\Cc$ form a category $\Fun(\Cc\op,\Set)$ with morphisms given by natural transformations.
\end{definition}

\begin{definition}[Hom-functor]
Let $\Cc$ be a category and $X\in \Cc$. We define the \textbf{Hom-functor} of $X$ to be
\[h_X:\functorDef{\Cc\op}{\Set}{T}{\Hom(T,X)}{f:T\to S}{h_X(f):\funcDef{\Hom(S,X)}{\Hom(T,X)}{g}{g\circ f}}\]
\end{definition}
\begin{remark}
The Hom-functor is a presheaf.
\end{remark}

\begin{lemma}[Yoneda Lemma]\label{YonedaLemma}
Let $\Cc$ be a category and $X\in \Cc$. If $F$ is a presheaf on $\Cc$ then the following sets are in a natural bijection
\[\Hom(h_X,F)\longleftrightarrow F(X).\]
\end{lemma}
\begin{proof}
Given a natural transformation $\zeta$, we can take its image in $F(X)$ to be $\zeta_X(id_X)$.
On the other hand, for any given element $u\in F(X)$ we can define an arrow $h_X(T)\to F(T)$ for any $T\in \Cc$ by taking $f\mapsto F(f)(u)$. This collection of maps defines a natural transformation from $h_X$ to $F$ because for all $g:S\to T$ and for all $f\in h_X(T)$
\[F(g)(F(f)(u))=(F(g)\circ F(f))(u)=F(f\circ g)(u)=F(h_X(g)(f))(u).\]
To conclude it is enough to check that the two assignments are inverses:
\[F(f)(\zeta_X(id_X))=\zeta_T(h_X(f)(id_X))=\zeta_T(f),\quad F(id_X)(u)=u.\]
\end{proof}

\begin{definition}[Yoneda embedding]
We define the \textbf{Yoneda embedding} of a category $\Cc$ to be the following functor
\[\yo:\functorDef{\Cc}{\Fun(\Cc\op,\Set)}{X}{h_X}{f:X\to Y}{h_f:h_X\to h_Y}\]
where if $g:T\to X$ then $h_f(g)=f\circ g:T\to Y$.
\end{definition}


\begin{proposition}
The functor $\yo$ is fully faithful.
\end{proposition}
\begin{proof}
Recall that a functor $F:\Cc\to \Dc$ is fully faithful if for any two objects $A,B\in\Cc$ we have $\Hom_\Cc(A,B)\cong \Hom_\Dc(F(A),F(B))$. In our case we want to verify that
\[\Hom(X,Y)\cong\Hom(h_X,h_Y),\]
which is exactly the statement of the Yoneda lemma (\ref{YonedaLemma}) for $F=h_Y$.
\end{proof}
\begin{proposition}\label{YonedaEmbeddingInjectiveOnIsoClasses}
The Yoneda embedding is injective up to isomorphism on isomorphism classes of objects in $\Cc$.
\end{proposition}
\begin{proof}
A natural isomorphism $\zeta:h_A\to h_B$ and its inverse $\zeta'$ correspond to maps $f:A\to B$ and $f':B\to A$ via the Yoneda lemma. Note that
\[\yo(f\circ f')=h_{f\circ f'}=h_f\circ h_{f'}=h_B(\cdot)(f)\circ h_A(\cdot)(f')\overset{\text{Yoneda}}=\zeta\circ \zeta'=id_{h_B},\]
thus, because $\yo$ if fully faithful, we see that $f\circ f'=id_B$. An analogous argument works for $f'\circ f$.
\end{proof}

\begin{lemma}\label{YonedaEmbeddingPreservesLimits}
The Yoneda embedding preserves limits.
\end{lemma}
\begin{proof}
Suppose $X$ is the limit of the diagram $\cpa{f_{ij}:X_j\to X_i}$. If we apply the Yoneda embedding to the diagram we obtain
\[\cpa{h_{f_{ij}}:h_{X_j}\to h_{X_i}}\]
Let $F$ be any presheaf on $\Cc$ and suppose that we have morphisms $F\to h_{X_i}$ which make the diagrams commute, then for all $T\in \Cc$ we have compatible and natural $F(T)\to \Hom(T,X_i)$. 
If $f\in F(T)$ then these arrows define several $f_i\in \Hom(T,X_i)$ which compose with the $f_{ij}$ respecting the diagram. 
By the universal property of limits this defines uniquely a morphism $f_\ell\in \Hom(T,X)$ and we see that the assignment $f\mapsto f_\ell$ is the unique map from $F(T)$ to $\Hom(T,X)$ which makes the diagram in $\Set$ commute. 
Since all that we have done is natural in $T$, we have effectively constructed a morphism $F\to h_X$ as we desired.
\end{proof}



\section{Moduli problems}

\begin{definition}[Representable functor]
A presheaf $F$ on $\Cc$ is \textbf{representable} if there exists a natural isomorphism $\zeta:F\to h_X$ for some $X\in \Cc$. 
In this case we say that the pair\footnote{usually we just say that $X$ represents $F$} $(X,\zeta)$ \textbf{represents} $F$.
If $a\in F(T)$ we call $\zeta_T(a):T\to X$ the \textbf{classifying map} of the family $a$.
\end{definition}
\begin{definition}[Universal family]
Given a functor $F$ and an object $X\in \Cc$ that represents it via the isomorphism $\zeta:F\to h_X$, the \textbf{universal family} of $X$ is
\[\zeta\ii_X(id_X)\in F(X).\]
\end{definition}
\begin{remark}
The universal family is the element of $F(X)$ which corresponds to $\zeta\ii$ under the Yoneda lemma (\ref{YonedaLemma}).
\end{remark}

We now specify our study to the category of schemes:

\begin{definition}[Moduli problem]
Let $S$ be a scheme. A presheaf on $\Sch S$ is called a \textbf{moduli problem} or \textbf{moduli functor}.
\end{definition}

\begin{example}[Moduli problem of smooth curves of fixed genus]
A \textit{family of smooth curves of genus $g$} over a scheme $S$ is a smooth and proper scheme morphism $C\to S$ such that for all $s\in S$ the fiber $C_s$ is a connected, smooth and proper curve of genus $g$. The moduli problem of smooth curves of genus $g$ is the functor
\[\functorDef{\Sch\C\op}{\Set}{S}{\quot{\cpa{\text{families of smooth curves of genus $g$ over $S$}}}\sim}{T\to S}{(C\to S)\mapsto (C\times_S T\to T)}\]
where two families $C\to S$ and $C'\to S$ are equivalent if there exists an isomorphism between $C$ and $C'$ which is compatible with the structure maps over $S$.
\end{example}

\begin{definition}[Fine moduli space]
Let $F$ be a moduli functor. A scheme $X\in \Sch S$ is a \textbf{fine moduli space} for $F$ if $X$ represents $F$.
\end{definition}

\begin{remark}
Because the Yoneda embedding is injective on isomorphism classes up to isomorphism (\ref{YonedaEmbeddingInjectiveOnIsoClasses}), fine moduli spaces are unique up to isomorphism.
\end{remark}

\begin{example}[Projective space]
Consider the functor
\[\Pj_n:\functorDef{\mathrm{Sch}\op}{\Set}{S}{\quot{\cpa{(\Lc,s_0,\cdots,s_n)\mid \emat{\Lc\text{ line bundle on $S$, }s_0,\cdots,s_n\in\Lc(S),\\\forall x\in S,\ \ps{(s_0)_x,\cdots,(s_n)_x}_{\Oc_{S,x}}=\Lc_x}}}\sim}{f}{\text{pullback of sheaves and sections via $f$}}\]
where $(\Lc,(s_i))\sim (\Lc',(s_i'))$ is there exists a sheaf isomorphism $\al:\Lc\to\Lc'$ such that $s_i=\al^\ast s_i'$ for all $i\in\cpa{0,\cdots, n}$.\medskip

It is a well know fact (Proposition 5.1.31 in \cite{QingLiu}) that $\Pj_n(S)\cong \Hom(S,\Pj^n_\Z)$ and that pullbacks behave as expected, thus $\Pj^n_\Z$ is a fine moduli space for $\Pj_n$.
From the statement of Proposition 5.1.31 in \cite{QingLiu} it is also clear that $\Oc_{\Pj^n_\Z}(1)$ is a universal family.
\end{example}

Fine moduli spaces do not always exist. The simplest obstructions to having a fine moduli spaces are
\begin{itemize}
\item the functor is not a Zariski sheaf (see proposition (\ref{RepresentableModuliFunctorsAreZariskiSheaves}))
\item existence of non trivial automorphisms.
\end{itemize}

To get an idea for why the second condition is an obstruction we cite the following
\begin{proposition}
Let $F\in \Psh{\C}{\Set}$ be a moduli functor. If there exists a variety $S\in \Sch \C$ such that $\Ec\in F(S)$ is an \textbf{isotrivial family}, i.e.
\begin{itemize}
\item for all $s,t\in S(\C)$, the fiber $F(s)(\Ec)=\Ec_s=\Ec_t$ and
\item the family $\Ec$ is not the pullback of an object $E\in F(\Spec \C)$ along the structural morphism $S\to \Spec \C$,
\end{itemize}
then there exists no fine moduli space for $F$.
\end{proposition}
\begin{proof}
This is Proposition 0.3.21 in \cite{Alper}.
\end{proof}
\begin{remark}
This proposition can be used to show that the moduli functor of smooth curves of fixed genus is not representable in general.
\end{remark}

A weaker notion of moduli space is that of coarse moduli space:
\begin{definition}[Coarse moduli space]
Let $F$ be a moduli problem. A pair $(X,\zeta)$ for $X\in \Sch S$ and $\zeta:F\to h_X$ natural transformation is a \textbf{coarse moduli space} for $F$ if
\begin{itemize}
\item $\zeta_{\Spec \K}:F(\Spec\K)\to \Hom(\Spec\K,X)$ is a bijection for all algebraically closed fields $\K$
\item for any scheme $Y$ and $\eta:F\to h_{Y}$ natural transformation there exists a unique morphism $\al:X\to Y$ such that $\eta=h_\al\circ \zeta$.
\end{itemize}
\end{definition}
\begin{proposition}
A fine moduli space is also a coarse moduli space.
\end{proposition}
\begin{proof}
The first condition is trivially verified. For the second condition, if $(Y,\eta)$ is defined as above and $(X,u)$ is the fine moduli space with universal family $u$ then we can take $\al=\eta_X(u)$.
\end{proof}


\section{Zariski sheaves and gluing of fine moduli spaces}
One approach to show representability of a moduli problem is emulating the gluing properties of sheaves.
Indeed it is possible to show that representable functors are sheaves of some kind. This realization will lead to some results that aid in showing representability. 

\subsection{Zariski sheaves}
First, let us formalize a way in which a functor can be a sheaf. First we recall the definition of equalizer:

\begin{definition}[Equalizer]
Let $\Cc$ be a category, $A,B,C\in \Cc$ and $f,g:B\to C$. We say that the the diagram 
% https://q.uiver.app/#q=WzAsMyxbMCwwLCJBIl0sWzEsMCwiQiJdLFsyLDAsIkMiXSxbMCwxLCJoIl0sWzEsMiwiZiIsMCx7Im9mZnNldCI6LTF9XSxbMSwyLCJnIiwyLHsib2Zmc2V0IjoxfV1d
\[\begin{tikzcd}
	A & B & C
	\arrow["h", from=1-1, to=1-2]
	\arrow["f", shift left, from=1-2, to=1-3]
	\arrow["g"', shift right, from=1-2, to=1-3]
\end{tikzcd}\]
is an \textbf{equalizer} if $h:A\to B$ is such that $f\circ h=g\circ h$ and if $(Q,q)$ is another such pair then there exists a unique morphism $Q\to A$ which makes the diagram commute
\[\begin{tikzcd}
	A & B & C \\
	Q
	\arrow["h", from=1-1, to=1-2]
	\arrow["f", shift left, from=1-2, to=1-3]
	\arrow["g"', shift right, from=1-2, to=1-3]
	\arrow["q"', from=2-1, to=1-2]
	\arrow[dashed, from=2-1, to=1-1]
\end{tikzcd}\]
\end{definition}

\begin{definition}[Zariski sheaf]
A moduli problem $F\in \Psh S\Set$ is a \textbf{Zariski sheaf} if for any $S$-scheme $X$ and any Zariski open cover $\cpa{U_i\to X}$ the following diagram is an equalizer
% https://q.uiver.app/#q=WzAsMyxbMCwwLCJGKFgpIl0sWzEsMCwiXFxkaXNwbGF5c3R5bGUgXFxwcm9kX2sgRihVX2spIl0sWzIsMCwiXFxkaXNwbGF5c3R5bGUgXFxwcm9kX3tpLGp9RihVX2lcXGNhcCBVX2opIl0sWzAsMV0sWzEsMiwiIiwwLHsib2Zmc2V0IjotMX1dLFsxLDIsIiIsMix7Im9mZnNldCI6MX1dXQ==
\[\begin{tikzcd}
	{F(X)} & {\displaystyle \prod_k F(U_k)} & {\displaystyle \prod_{i,j}F(U_i\cap U_j)}
	\arrow[from=1-1, to=1-2]
	\arrow[shift left, from=1-2, to=1-3]
	\arrow[shift right, from=1-2, to=1-3]
\end{tikzcd}\]
where the arrows are induced by the inclusions.
\end{definition}

\begin{remark}
Using the Yoneda lemma (\ref{YonedaLemma}), we may equivalently consider
% https://q.uiver.app/#q=WzAsMyxbMCwwLCJcXEhvbShoX1gsRikiXSxbMSwwLCJcXGRpc3BsYXlzdHlsZSBcXHByb2RfayBcXEhvbShoX3tVX2t9LEYpIl0sWzIsMCwiXFxkaXNwbGF5c3R5bGUgXFxwcm9kX3tpLGp9XFxIb20oaF97VV9pXFxjYXAgVV9qfSxGKSJdLFswLDFdLFsxLDIsIiIsMCx7Im9mZnNldCI6LTF9XSxbMSwyLCIiLDIseyJvZmZzZXQiOjF9XV0=
\[\begin{tikzcd}
	{\Hom(h_X,F)} & {\displaystyle \prod_k \Hom(h_{U_k},F)} & {\displaystyle \prod_{i,j}\Hom(h_{U_i\cap U_j},F)}
	\arrow[from=1-1, to=1-2]
	\arrow[shift left, from=1-2, to=1-3]
	\arrow[shift right, from=1-2, to=1-3]
\end{tikzcd}\]
\end{remark}


\begin{proposition}[Representable moduli functors are Zariski sheaves]\label{RepresentableModuliFunctorsAreZariskiSheaves}
Let $F$ be a moduli problem, then if there exists a fine moduli space $M$ for $F$ it must be the case that $F$ is a Zariski sheaf.
\end{proposition}
\begin{proof}
Up to composing with the natural isomorphism, we may assume $F=h_M$. 
Let $X$ be an $S$-scheme and $\cpa{U_i\to X}$ a Zariski open cover for it. 
We want to show that the following diagram is an equalizer
% https://q.uiver.app/#q=WzAsMyxbMCwwLCJcXEhvbShVLE0pIl0sWzEsMCwiXFxkaXNwbGF5c3R5bGUgXFxwcm9kX2kgXFxIb20oVV9pLE0pIl0sWzIsMCwiXFxkaXNwbGF5c3R5bGUgXFxwcm9kX3tpLGp9XFxIb20oVV9pXFxjYXAgVV9qLE0pIl0sWzAsMSwiUmVzIl0sWzEsMiwicHJfMV5cXGFzdCIsMCx7Im9mZnNldCI6LTF9XSxbMSwyLCJwcl8yXlxcYXN0IiwyLHsib2Zmc2V0IjoxfV1d
\[\begin{tikzcd}
	{\Hom(U,M)} & {\displaystyle \prod_i \Hom(U_i,M)} & {\displaystyle \prod_{i,j}\Hom(U_i\cap U_j,M)}
	\arrow["Res", from=1-1, to=1-2]
	\arrow["{pr_1^\ast}", shift left, from=1-2, to=1-3]
	\arrow["{pr_2^\ast}"', shift right, from=1-2, to=1-3]
\end{tikzcd}\]
The arrows correspond to restriction of morphisms, so what we need to verify is that
\begin{itemize}
\item $\mathrm{res}^{U_i}_{U_i\cap U_j}\circ \mathrm{res}^X_{U_i}=\mathrm{res}^{U_j}_{U_i\cap U_j}\circ \mathrm{res}^X_{U_j}$ and that
\item a collection of maps $\cpa{f_i:U_i\to M}$ such that $f_i\res{U_i\cap U_j}=f_j\res{U_i\cap U_j}$ glues uniquely to a map $f:X\to M$.
\end{itemize}
Both propositions are well known properties of scheme morphisms.
\end{proof}

\subsection{Open cover of a moduli problem}
\begin{definition}[Subfunctor]
A functor $G:\Cc\to \Set$ is a \textbf{subfunctor} of $F:\Cc\to \Set$ if for all $X,A,B\in \Cc$ and for all $f\in \Hom(A,B)$
\[G(X)\subseteq F(X),\qquad\text{and}\qquad G(f)=F(f)\res{G(A)}.\]
In this case we write $G\subseteq F$.
\end{definition}
\begin{remark}
If $F$ and $G$ are presheaves and $f:A\to B$ then $G(f)=F(f)\res{G(B)}$.
\end{remark}

\begin{definition}[Fibered product of presheaves]
Let $F,G,H:\Cc\op\to\Set$ be presheaves together with two natural transformations $\eta:F\to H$ and $\zeta:G\to H$. We define their fibered product as the following functor
\[F\times_H G:\functorDef{\Cc\op}{\Set}{X}{F(X)\times_{H(X)}G(X)}{f:A\to B}{(b_1,b_2)\mapsto(F(f)(b_1),G(f)(b_2))}\]
where the fibered product $F(X)\times_{H(X)}G(X)$ in defined through the maps $\eta_X$ and $\zeta_X$. The map $(F\times_H G)(f)$ is well defined because if $(b_1,b_2)\in F(B)\times_{H(B)}G(B)$ then 
\[\eta_A(F(f)(b_1))=H(f)(\eta_B(b_1))\pasgnlmath={\eta_B(b_1)=\zeta_B(b_2)}H(f)(\zeta_B(b_2))=\zeta_A(G(f)(b_2)).\]
\end{definition}

\begin{definition}[Open subfunctor]
Let $F:\Psh S\Set$ be a moduli problem. We say that a subfunctor $G\subseteq F$ is \textbf{open} if for any $S$-scheme $T$ and any natural transformation $h_T\to F$, there exists an open subscheme $U\subseteq T$ such that
% https://q.uiver.app/#q=WzAsNixbMSwwLCJoX1UiXSxbMSwxLCJoX1QiXSxbMiwxLCJGIl0sWzIsMCwiRyJdLFswLDAsIlUiXSxbMCwxLCJUIl0sWzMsMl0sWzEsMl0sWzAsMywiIiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzAsMSwiIiwyLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzAsMiwiIiwxLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lci1pbnZlcnNlIn19XSxbNCw1LCJcXHN1YnNldGVxIiwzLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzQsMCwiXFx5byJdLFs1LDEsIlxceW8iXV0=
\[\begin{tikzcd}
	U & {h_U} & G \\
	T & {h_T} & F
	\arrow["\yo", from=1-1, to=1-2]
	\arrow["\subseteq"{marking, allow upside down}, draw=none, from=1-1, to=2-1]
	\arrow[dashed, from=1-2, to=1-3]
	\arrow[dashed, from=1-2, to=2-2]
	\arrow["\ulcorner"{anchor=center, pos=0.125}, draw=none, from=1-2, to=2-3]
	\arrow[from=1-3, to=2-3]
	\arrow["\yo", from=2-1, to=2-2]
	\arrow[from=2-2, to=2-3]
\end{tikzcd}\]
i.e. $U$ represents $h_T\times_F G$ and the map from $h_U$ to $h_T$ is given by the inclusion.
\end{definition}

Because of the Yoneda lemma, giving a natural transformation like in the above definition is equivalent to choosing a family $\xi\in F(T)$. We can thus rephrase the definition as follows

\begin{definition}[Open subfunctor v.2]
A subfunctor $G\subseteq F$ is open if for any $S$-scheme $T$ and any family $\xi\in F(T)$ there exists an open subscheme $\iota:U\inj T$ such that the following diagram is natural in $R$ for all $R\in \Sch S$, commutes and is cartesian\footnote{for any map $f:R\to U$ there exists a $g:R\to U$ such that $f=\iota\circ g$ if and only if $F(f)(\xi)\in G(R)$.}
% https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXEhvbShSLFUpIl0sWzAsMSwiXFxIb20oUixUKSJdLFsyLDAsIkcoUikiXSxbMiwxLCJGKFIpIl0sWzAsMSwiXFxzdWJzZXRlcVxcY2lyYyIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Imhvb2siLCJzaWRlIjoidG9wIn19fV0sWzAsMiwiRyhcXHN1YnNldGVxIFxcY2lyYyB+flxcY2RvdH4pKFxceGkpIl0sWzEsMywiRihcXGNkb3QpKFxceGkpIiwyXSxbMiwzLCJcXHN1YnNldGVxIiwwLHsic3R5bGUiOnsidGFpbCI6eyJuYW1lIjoiaG9vayIsInNpZGUiOiJ0b3AifX19XSxbMCw2LCIiLDEseyJsZXZlbCI6MSwic3R5bGUiOnsibmFtZSI6ImNvcm5lci1pbnZlcnNlIn19XV0=
\[\begin{tikzcd}
	{\Hom(R,U)} && {G(R)} \\
	{\Hom(R,T)} && {F(R)}
	\arrow["{G\circ h_\iota(\cdot)(\xi)}", from=1-1, to=1-3]
	\arrow["h_\iota"', hook, from=1-1, to=2-1]
	\arrow["\subseteq", hook, from=1-3, to=2-3]
	\arrow[""{name=0, anchor=center, inner sep=0}, "{F(\cdot)(\xi)}"', from=2-1, to=2-3]
	\arrow["\ulcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=0]
\end{tikzcd}\]
\end{definition}

\begin{definition}[Open cover of a functor]
Let $F:\Psh S\Set$ be a moduli problem. A collection of open subfunctors $\cpa{F_i\to F}$ is an \textbf{open cover} of $F$ if for any $S$-scheme $T$ and any natural transformation $h_T\to F$, the open subschemes $U_i$ of $T$ determined by the $F_i$ form an open cover of $T$.
\end{definition}



\begin{definition}[Restriction of a family]
If $U$ is a subscheme of $T$ and $\iota:U\to T$ is the inclusion morphism, then if $\xi\in F(T)$ we define its \textbf{restriction} to $U$ to be
\[\xi\res U=F(\iota)(\xi).\]
\end{definition}

\begin{remark}
If $\cpa{F_i\to F}$ is an open cover of the functor $F$ then for any $S$-scheme $T$ and any family $\xi\in F(T)$ there exists an open cover $\cpa{U_i\to T}$ of $T$ such that $\xi\res{U_i}\in F_i(U_i)$ for all $i$.
\end{remark}

\subsection{Representability criterion}
Finally, we come to the main results of this chapter

\begin{proposition}\label{MapGluingForZariskiSheaves}
Let $F$ and $G$ be Zariski sheaves, $\cpa{F_i\to F}$ and $\cpa{G_i\to G}$ be open covers with the same indexation and $f_i:F_i\to G_i$ be natural transformations such that\footnote{for a natural transformation $\zeta:F\to H$ and a subfunctor $G\subseteq F$, we define $\zeta\res G$ as the natural transformation $G\to H$ given by $(\zeta\res G)_T=\zeta_T\res{G(T)}$. Naturality follows from the naturality of $f$ and the definition of subfunctor.} $f_i\res{F_i\cap F_j}=f_j\res{F_i\cap F_j}$. 
Then there exists a natural transformation $f:F\to G$ which restricts to $f_i$ on $F_i$.
\end{proposition}
\begin{proof}
Let $T$ be a scheme and $\zeta:h_T\to F$ a natural transformation. Let $\cpa{\iota_i:U_i\to T}$ be the open cover induced by $\cpa{F_i\to F}$ through $\zeta$ by the definition of open subfunctor cover.
% https://q.uiver.app/#q=WzAsNixbMSwxLCJGIl0sWzEsMCwiRl9pIl0sWzIsMCwiR19pIl0sWzIsMSwiRyJdLFswLDEsImhfVCJdLFswLDAsImhfe1VfaX0iXSxbMSwyLCJmX2kiXSxbMSwwLCJcXHN1YnNldGVxIiwzLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzIsMywiXFxzdWJzZXRlcSIsMyx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6Im5vbmUifSwiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFs1LDQsImhfe1xcaW90YV9pfSIsMl0sWzQsMCwiXFx6ZXRhIiwyXSxbNSwxLCJcXGV0YV9pIl0sWzUsMCwiIiwyLHsic3R5bGUiOnsibmFtZSI6ImNvcm5lci1pbnZlcnNlIn19XV0=
\[\begin{tikzcd}
	{h_{U_i}} & {F_i} & {G_i} \\
	{h_T} & F & G
	\arrow["{\eta_i}", from=1-1, to=1-2]
	\arrow["{h_{\iota_i}}"', from=1-1, to=2-1]
	\arrow["\ulcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=2-2]
	\arrow["{f_i}", from=1-2, to=1-3]
	\arrow["\subseteq"{marking, allow upside down}, draw=none, from=1-2, to=2-2]
	\arrow["\subseteq"{marking, allow upside down}, draw=none, from=1-3, to=2-3]
	\arrow["\zeta"', from=2-1, to=2-2]
\end{tikzcd}\]
where $\eta_i$ is the map $\zeta\circ h_{\iota_i}$ with its codomain restricted. This map is well defined because the square is cartesian.
Let $g_i=f_i\circ \eta_i$ and note that
\[g_i\res{h_{U_i\cap U_j}}=f_i\res{F_i\cap F_j}\circ \eta_i \res{h_{U_i\cap U_j}}=f_j\res{F_i\cap F_j}\circ \eta_j\res{h_{U_i\cap U_j}}=g_j\res{h_{U_i\cap U_j}}.\]
Because $G$ is a Zariski sheaf, there exists $\zeta':h_T\to G$ such that $\zeta'\circ h_{\iota_i}=g_i$. We have thus constructed a map $\Hom(h_T,F)\to \Hom(h_T,G)$ which is functorial in $T$ by naturality of the maps involved. Applying the Yoneda lemma (\ref{YonedaLemma}) gives a map $F(T)\to G(T)$ which is functorial in $T$, i.e. $f:F\to G$. By construction it is also clear that $f\res{F_i}=f_i$.
\end{proof}
\begin{corollary}\label{IsomorphismGluingForZariskiSheaves}
With the same setup as above, if each $f_i$ is an isomorphism then $f$ too is an isomorphism.
\end{corollary}
\begin{proof}
Let $f$ be the morphism $F\to G$ obtained as above and let $g:G\to F$ be the morphism obtained the same way but by gluing the $f_i\ii:G_i\to F_i$. It is easy to see that $f$ and $g$ are inverses with a local argument.
\end{proof}


\begin{theorem}[Representability by open cover]\label{RepresentabilityByOpenSubfunctorCover}
Let $F:\Psh{S}{\Set}$ be a Zariski sheaf and let $\cpa{F_i\to F}$ be an open cover of it by representable subfunctors, then $F$ is representable.
\end{theorem}
\begin{proof}[Sketch.]
We fix schemes $X_i$ and families $\xi_i\in F_i(X_i)$ such that $(X_i,\xi_i)$ is a fine moduli space for $F_i$. For all $S$-schemes $T$ we have
\[(F_i\times_F F_j)(T)=F_i(T)\times_{F(T)}F_j(T)=F_i(T)\cap F_j(T)\subseteq F(T),\]
thus $F_i\times_F F_j=F_j\times_F F_i\doteqdot F_{i,j}$. 

Using the openness of $F_j$ we find $U_{ij}\subseteq X_i$ which represents $h_{X_i}\times_FF_j\cong F_{i,j}$. By uniqueness of moduli spaces we see that there exists an isomorphism $\vp_{ji}:U_{ij}\to U_{ji}$, which we can choose to correspond to the identity $F_{i,j}= F_{j,i}$.

Our choice for the maps $\vp_{ji}$ makes the cocycle condition $\vp_{ki}=\vp_{kj}\circ \vp_{ji}$ hold trivially. We can thus glue the $X_i$ to a scheme $X$. Since $\xi_i\res{U_ij}=\xi_j\res{U_{ij}}$ by construction of $\vp_{ji}$, we find a family $\xi\in F(X)$ by the sheaf property of $F$. It follows easily that $(X,\xi)$ represents $F$.
\end{proof}

