\chapter{Quot and Hilbert schemes}
In the definition of the Grassmannian moduli problem the concept of quotient sheaves turned out to be instrumental. 
Since we have only considered quotients that are vector bundles of a fixed rank $k$, a natural next step might be to generalize the construction to general coherent sheaves. 
This generalization has proven itself to be vital in the construction of many fine moduli spaces, the most important example being the Hilbert schemes. 
The representability of both the functor of quotients and the Hilbert moduli problem were proven by Grothendieck in \cite{FGAVI}.

In this chapter we will present a proof of the representability of a particular class of functors of quotients while taking most technical results about Castelnuovo-Mumford regularity, flat base change and flattening stratifications as a given. 
Along the way we will show some examples of how this problem is related to the one of Hilbert schemes and Grassmannians. Our approach will follow closely the one given in \cite{Alper} and \cite{FGAEXPLAINED}.\smallskip

%From now on we will only consider locally noetherian schemes. 
%In particular $\Sch S$ now refers to the full subcategory of locally noetherian schemes over $S$. 
%We will also consider our universal base scheme to be $\Spec \K$ instead of the more general $\Spec\Z$ for consistency with our work from the previous chapters.
We will usually consider our base scheme to be $\Spec \K$ for consistency with our work from the previous chapters.
For simplicity we will sometimes write $\K$ instead of $\Spec \K$.
\begin{notation}
If $T$ is a scheme we use $\pi_T$ to denote the structure map $\Pj^n_T\to T$. When $T=\Spec\K$ we omit the subscript.
\end{notation}

\begin{notation}
If $X$ and $T$ are $S$-schemes we write the base change of $X$ as $X_T=X\times_S T$. With this notation we imply that we are considering $X_T$ as a $T$-scheme.
\end{notation}


\section{Functor of quotients}
\begin{definition}[Functor of quotients]
Let $S$ be a noetherian scheme and let $X\to S$ be a morphism of finite type. Let $\Ec$ be a coherent sheaf on $X$. If $T\in \Sch S$, a \textbf{family of quotients of $\Ec$ parameterized by $T$} (or \textbf{over $T$}) is a surjective sheaf morphism\footnote{we will usually simply state ``$q:\Ec_T\to Q$ is a quasi-coherent locally finitely presented quotient sheaf flat over $T$ with proper support".} $q:\Ec_T\to Q$ where $\Ec_T$ is the pullback of $\Ec$ under $X_T\to X$ and $Q$ is a quasi-coherent locally finitely presented sheaf on $X_T$ which is flat over $T$ and whose support is proper over $T$.

Two families of quotients $q$ and $q'$ are said to be equivalent, written $q\sim q'$, if $\ker q=\ker q'$. We denote the equivalence class $[q]$ or more explicitly $[q:\Ec_T\to Q]$. We define the \textbf{functor of quotients of $\Ec$ over the base $S$} as
\[\quotf_{\Ec/X/S}:\functorDef{\Sch S\op}{\Set}{T}{\cpa{[q]\mid q\text{ family of quotients of $\Ec$ over $T$}}}{f:T'\to T}{[q:\Ec_T\to Q]\mapsto f^\ast[q]=[f^\ast q:\Ec_{T'}\to f^\ast Q]}\]
\end{definition}

\begin{remark}
The functor is well defined because properness, flatness, quasi-coherence and finite local presentation are preserved under base change (so $f^\ast Q$ is a valid output) and the tensor product is right exact, so surjectivity of the maps is also preserved.
\end{remark}

\begin{remark}
A family of quotients over a locally noetherian scheme $q:\Ec_T\to Q$ is such that $Q$ is coherent. We can restrict to considering this case for local considerations in the following way:
\begin{itemize}
\item all commutative rings are the colimit of their subrings which are finitely generated $\Z$-algebras, i.e. they are the colimit of noetherian rings
\item it follows that affine schemes are the limit of noetherian affine schemes
\item all schemes are locally affine by definition
\item the locally finitely presented sheaves over an affine scheme $\Spec A=\lim \Spec A_i$ can be obtained as the colimit of the locally finitely presented sheaves over each $\Spec A_i$.
\end{itemize}
Because of this we will implicitly consider the schemes in the following sections to be locally noetherian when checking for local conditions.
\end{remark}


\subsection{Stratification by Hilbert polynomials}
\begin{notation}
If a line bundle $\Lc$ on $X$ is fixed and $\Fc$ is a quasi-coherent sheaf on $X$ we denote the $r$-twist $\Fc\otimes_{\Oc_X}\Lc^{\otimes r}$ as $\Fc(r)$ for all integers $r$.
\end{notation}
\begin{definition}[Euler characteristic of a sheaf]
Let $X$ be a closed subscheme of $\Pj^n_\K$. If $\Fc$ is a coherent sheaf on $X$ with proper support over $\K$ we define the \textbf{Euler characteristic} of $\Fc$ as
\[\chi(\Fc)=\sum_{i\geq 0}(-1)^i\dim_\K H^i(X,\Fc).\]
It is a well known result that, given our hypotheses, this sum is finite. See Theorem {\sc III}.2.7 from \cite{Hartshorne}.
\end{definition}

\begin{theorem}[Snapper's lemma]
If we fix a line bundle $\Lc$, the map $r\mapsto \chi(\Fc(r))$ defines a polynomial $\Phi(\la)\in\Q[\la]$, which is called the \textbf{Hilbert polynomial} of the sheaf $\Fc$.
\end{theorem}
\begin{proof}
See Theorem B.7, page 314 of \cite{FGAEXPLAINED}.
\end{proof}

\begin{remark}\label{HilbertoPolynomialGivesDimentionForLargeInput}
If $\Lc$ is ample and $r$ is sufficiently large, $\Phi(r)=\dim_\K H^0(X,\Fc(r))$. This follows from Serre's vanishing theorem (proposition {\rm III}.5.3 in \cite{Hartshorne}).
\end{remark}

We are interested in Hilbert polynomials because of the following property

\begin{theorem}\label{SemicontinuityTheorem}
Let $X\to S$ be a proper morphism of noetherian schemes, $\Lc$ a line bundle on $X$ and $\Fc$ a coherent sheaf on $X$ with proper support and flat over $S$. For all $s\in S$ let $X_s$ be the fiber of $s$. We define $\Phi_s$ to be the Hilbert polynomial of $\Fc\res{X_s}$ calculated with respect to the line bundle $\Lc\res{X_s}$. The function
\[\funcDef{S}{\Z}{s}{\Phi_s(r)}\]
is locally constant for all $r\in\Z$.
\end{theorem}
\begin{proof}
This is Theorem A.6.4 in \cite{Alper}.
\end{proof}

Because of this, we can decompose the functor of quotients as the following coproduct
\[\quotf_{\Ec/X/S}=\coprod_{\Phi\in\Q[\la]}\quotf^{\Phi,\Lc}_{\Ec/X/S},\text{ where}\]
\[\quotf^{\Phi,\Lc}_{\Ec/X/S}(T)=\quot{\cpa{\text{families of quotients over $T$ such that $\forall t\in T,\ \Phi_t=\Phi$}}}\sim.\]

\subsection{Special cases of the functor of quotients}
This finer decomposition allows us to formalize how the Grassmannian moduli problem is a special case of the functor of quotients.
\begin{proposition}
We have the equality
\[\gr(k,n)=\quotf^{k,\Oc_{\K}}_{\Oc_{\K}^n/\K/\K}\]
\end{proposition}
\begin{proof}
% VERY USEFUL Q&A ABOUT THIS: https://math.stackexchange.com/questions/1724850/if-the-hilbert-polynomial-of-coherent-sheaf-is-constant-number-then-locally-free
The pullbacks and equivalence relations are defined in the same way, so it is enough to show that they agree when evaluated on a $\K$-scheme $T$. It is clear that $(\Oc_{\K}^n)_T=\Oc_T^n$ so we just need to show that $\Fc$ has Hilbert polynomial $k$ with respect to the line bundle $\Oc_T$ and is flat over $T$ if and only if $\Fc$ if a vector bundle or rank $k$ over $(\Spec \K)_T$. 
\setlength{\leftmargini}{1.2cm}
\begin{itemize}
\item[$\boxed{\implies}$] If $\Fc$ is coherent and flat over $T$ then\footnote{implication $(1)\implies (6)$ from \href{https://stacks.math.columbia.edu/tag/00NX}{Lemma 00NX} in \cite{stacks}} it is locally free over $T$ and since $T\cong(\Spec\K)_T$, $\Fc$ is locally free over $(\Spec\K)_T$. Because $T\cong(\Spec\K)_T$, the fibers $(\Spec\K)_t$ are points and so $\Fc\res{(\Spec \K)_t}=\Fc_t$. By assumption, the Hilbert polynomial of this sheaf is $k$ for all $t\in T$, so 
\[k=\dim_\K H^0(\Spec k(t),\Fc_t(r))=\rnk \Fc_t(r)\quad \text{for large }r.\]
Since $\Lc_T=\Oc_T$ we have $\Fc_t(r)\cong \Fc_t$, so $\rnk \Fc_t=k$ for all $t\in T$, i.e. $\Fc$ is a locally free sheaf of rank $k$.
\item[$\boxed{\impliedby}$] A locally free sheaf of rank $k$ on $T$ is obviously coherent and flat over $T$. Since $\Lc$ in our case is the trivial line bundle, $\Fc_t\otimes \Oc_{k(t)}^{\otimes r}\cong \Fc_t$, so $\Phi_t(r)$ cannot depend on $r$ and is therefore a constant polynomial. Let $d_t$ be the value of $\Phi_t$. Since $\rnk \Fc_t=\rnk \Fc_t(r)$, for large $r$ we have 
\[d_t=\Phi_t(r)=\dim_\K H^0(\Spec k(t), \Fc_t(r))=\rnk\Fc_t=k,\]
so for all fibers, $\Phi_t$ is the constant polynomial $k$.
\end{itemize}
\setlength{\leftmargini}{0.5cm}
\end{proof}

Now we define the Hilbert moduli problem and show how it relates to the functor of quotients:

\begin{definition}[Hilbert functor]
Let $X$ be a closed subscheme of $\Pj^n_\K$.
If $T$ is a scheme, a \textbf{family of subschemes of $X$} is a closed subscheme $Y\subseteq X\times T$ such that $Y$ is flat and finitely presented over $T$. 
We can define the \textbf{Hilbert functor of $X$} as
\[\hilb_{X}:\functorDef{(\Sch{\K})\op}{\Set}{T}{\cpa{Y\subseteq X\times T\mid Y\text{ flat and finitely presented over }T}}{f:T\to S}{Y\subseteq X\times S\mapsto f^\ast Y=(id_{X}\times f)\ii(Y)\subseteq X\times T}\]
\end{definition}

\begin{proposition}\label{HilbertIsAQuotScheme}
We have a canonical identification
\[\hilb_X=\quotf_{\Oc_X/X/\K}.\]
In particular, we can also define a decomposition of the Hilbert moduli problem in terms of Hilbert polynomials\footnote{the Hilbert polynomial of a closed subscheme is the Hilbert polynomial of its sheaf of ideals.}
\[\hilb^{\Phi,\Lc}_{X}:\funcDef{(\Sch{\K})\op}{\Set}{T}{\cpa{Y\subseteq X\times T\left| \emat{Y\text{ flat and finitely presented}\\\text{over $T$ such that the fiber $Y_t$ has}\\\text{Hilbert polynomial $\Phi$ for all $t\in T$}}\right.}}\]
\end{proposition}
\begin{proof}
There is a well known bijection between closed subschemes of a given scheme and quasi-coherent sheaves of ideals on the scheme (Proposition 5.1.15 in \cite{QingLiu}). By construction the structure sheaf of $Y$ is finitely presented and flat over $T$, so the ideal sheaf which defines $Y$ can be expressed as the kernel of the quotient of coherent sheaves $q:\Oc_{X_T}\to \Oc_Y$. Given how the equivalence of quotients is defined this shows that a class of quotients of $\Oc_{X_T}$ corresponds exactly to a family $Y$, giving us the identification we wanted.
\end{proof}

\section{Castelnuovo-Mumford regularity and Flattening stratification}

We now introduce the concept of regularity. The original proof of the representability of $\quotf$ by Grothendieck in \cite{FGAVI} did not make use of this definition. Nevertheless, Castelnuovo-Mumford regularity proved to be the easier method to employ to reach the result and is now the more popular approach.

\begin{definition}[$m$-regular sheaves]
A coherent sheaf $\Fc$ on $\Pj^n_\K$ is \textbf{$m$-regular} for an integer $m$ if for all $i\geq 1$ we have
\[H^i(\Pj^n_\K,\Fc(m-i))=0.\]
\end{definition}

\begin{lemma}\label{RegularityOnExactSequences}
Let $0\to\Kc\to\Ec\to\Qc\to 0$ be a short exact sequence of coherent sheaves on $\Pj^n_\K$, then if $\Kc$ is $(m+1)$-regular and $\Ec$ is $m$-regular then $\Qc$ is $m$-regular.
\end{lemma}
\begin{proof}
Let us fix an integer $i\geq 1$. By tensoring with $\Oc_{\Pj^n_\K}(m-i)$ we get an exact sequence
% https://q.uiver.app/#q=WzAsNSxbMCwwLCIwIl0sWzEsMCwiXFxLYyhtLWkpIl0sWzIsMCwiXFxFYyhtLWkpIl0sWzMsMCwiXFxRYyhtLWkpIl0sWzQsMCwiMCJdLFszLDRdLFsyLDNdLFsxLDJdLFswLDFdXQ==
\[\begin{tikzcd}
	0 & {\Kc(m-i)} & {\Ec(m-i)} & {\Qc(m-i)} & 0
	\arrow[from=1-1, to=1-2]
	\arrow[from=1-2, to=1-3]
	\arrow[from=1-3, to=1-4]
	\arrow[from=1-4, to=1-5]
\end{tikzcd}\]
We can conclude by studying the following chunk of the long exact sequence associated to the short one above
% https://q.uiver.app/#q=WzAsNSxbMCwwLCJIXmkoXFxQal5uX1xcSyxcXEVjKG0taSkpIl0sWzEsMCwiSF5pKFxcUGpebl9cXEssXFxRYyhtLWkpKSJdLFsyLDAsIkhee2krMX0oXFxQal5uX1xcSyxcXEtjKG0taSkpIl0sWzIsMSwiMCJdLFswLDEsIjAiXSxbMSwyXSxbMCwxXSxbMywyLCI9IiwzLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoibm9uZSJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzQsMCwiPSIsMyx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6Im5vbmUifSwiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dXQ==
\[\begin{tikzcd}
	{H^i(\Pj^n_\K,\Ec(m-i))} & {H^i(\Pj^n_\K,\Qc(m-i))} & {H^{i+1}(\Pj^n_\K,\Kc(m-i))} \\
	0 && 0
	\arrow[from=1-1, to=1-2]
	\arrow[from=1-2, to=1-3]
	\arrow["{=}"{marking, allow upside down}, draw=none, from=2-1, to=1-1]
	\arrow["{=}"{marking, allow upside down}, draw=none, from=2-3, to=1-3]
\end{tikzcd}\]
We used the identity $m-i=m+1-(i+1)$ to show that the third term is zero.
\end{proof}

The following result was attributed to Castelnuovo by Mumford in \cite{mumford1966lectures}
\begin{lemma}[Castelnuovo]\label{CastelnuovoLemma}
Let $\Fc$ be an $m$-regular coherent sheaf on $\Pj^n_\K$, then the following results hold:
\begin{enumerate}
\item[\rm(a)] If $r\geq m$ then the map
\[H^0(\Pj^n_\K,\Oc_{\Pj^n_\K}(1))\otimes H^0(\Pj^n_\K,\Fc(r))\to H^0(\Pj^n_\K,\Fc(r+1))\]
given by the product of sections is surjective.
\item[\rm(b)] If $r\geq m-i$ for $i\geq 1$ then $H^i(\Pj^n_\K,\Fc(r))=0$.
\item[\rm(c)] If $r\geq m$ then $\Fc(r)$ is globally generated and $H^i(\Pj^n_\K,\Fc(r))=0$ for all $i\geq 1$.
\end{enumerate}
\end{lemma}
\begin{proof}
This is Lemma 5.1 from \cite{FGAEXPLAINED}.
\end{proof}

\begin{corollary}\label{RegularityUnboundedAbove}
If $\Fc$ is $m$-regular then it is also $m'$-regular for all $m'\geq m$.
\end{corollary}
\begin{proof}
This is statement (b) from the lemma where we choose $r=m'-i\geq m-i$.
\end{proof}

\begin{theorem}[Mumford]\label{MumfordTheorem}
Let $p$ and $n$ be non-negative integers, then there exists a polynomial $F_{p,n}\in\Z[x_0,\cdots, x_n]$ such that, if $\Fc$ is a coherent sheaf on $\Pj^n_\K$ which is isomorphic to a subsheaf of $\Oc^p_{\Pj^n_\K}$ with Hilbert polynomial\footnote{Recall that every polynomial with rational coefficients can be written in this form uniquely.}
\[\chi(\Fc(r))=\sum_{i=0}^na_i\binom ri,\quad a_i\in\Z,\]
then $\Fc$ is $m$-regular for $m=F_{p,n}(a_0,\cdots, a_n)$.
\end{theorem}
\begin{proof}
This is Theorem 5.3 in \cite{FGAEXPLAINED}.
\end{proof}

\begin{proposition}[Regularity in Families]\label{RegularityInFamilies}
Let $S$ be a noetherian scheme and let $Q$ be a coherent sheaf on $\Pj^n_S$ which is flat over $S$. Suppose that there exists $m>0$ such that for all $s\in S$, $Q\res{\Pj^n_{k(s)}}$ is $m$-regular, then for $r\geq m$
\begin{enumerate}
\item ${\pi_S}_\ast Q(r)$ is a vector bundle and, if $f:T\to S$ is an $S$-scheme, then we have
\[f^\ast{\pi_S}_\ast Q(r)\cong {\pi_T}_\ast Q_T(r).\]
\item If $i\geq 1$ the higher direct images $R^i{\pi_S}_\ast Q(d)$ vanish.
\item The morphism ${\pi_S}^\ast{\pi_S}_\ast Q(d)\to Q(d)$ is surjective.
\end{enumerate}
\end{proposition}
\begin{proof}
This is Proposition 1.3.18 in \cite{Alper}.
\end{proof}


\begin{theorem}[Existence of flattening stratifications]\label{FlatetningStratifications}
Let $S$ be a noetherian scheme and let $\Fc$ be a coherent sheaf on $\Pj^n_S$. 
\begin{itemize}
\item For all polynomials $\Phi\in\Q[\la]$ there exists a locally closed subscheme $S_\Phi\subseteq S$ such that a morphism $T\to S$ factors through $S_\Phi$ if and only if the pullback $\Fc_T$ of $\Fc$ to $\Pj^n_T$ is flat over $T$ and for all $t\in T$, $\Fc_{k(t)}$ has Hilbert polynomial $\Phi$.
\item There exists a finite subset $I\subseteq \Q[\la]$ such that set-theoretically
\[S=\coprod_{\Phi\in I}S_\Phi\]
\item The closure of $S_\Phi$ in $S$ is a subset of the union $\bigcup_{P\leq Q}S_Q$, where $P\leq Q\coimplies P(m)\leq Q(m)$ for $m\gg 0$.
\end{itemize}
\end{theorem}
\begin{proof}
This is Theorem 5.13 in \cite{FGAEXPLAINED}.
\end{proof}



\section{The existence theorem}

Note that $\quotf$ is not always representable\footnote{A case where representability fails is given in chapter 5, section 5.1.5, example (8) of \cite{FGAEXPLAINED}.}. The result that we will show is
\begin{theorem}\label{AltmanKelimanEasy}
Let $X$ be a closed subscheme of $\Pj^n_\K$ for some $n$, $\Lc=\Oc_{\Pj^n_\K}(1)\res X$, $\Ec$ a coherent quotient of $\Oc_{X}(\nu)^p$ for some integers $p$ and $\nu$ and $\Phi\in\Q[\la]$. Then the functor of quotients $\quotf^{\Phi,\Lc}_{\Ec/X/\K}$ is representable by a scheme $\Quot^{\Phi,\Lc}_{\Ec/X/\K}$. 
\end{theorem}
This is a specific case of the version showcased in \cite{ALTMAN198050}. For more historical background see subsection 5.5.2 of \cite{FGAEXPLAINED}.

\begin{remark}
If the theorem holds, we can define the Hilbert schemes as
\[\Hilb^{\Phi,\Lc}_{X}=\Quot^{\Phi,\Lc}_{\Oc_{X}/X/\K}\qquad\qquad \Hilb_X=\coprod_{\Phi\in\Q[\la]}\Hilb^{\Phi,\Lc}_{X}.\]
\end{remark}

\begin{proposition}\label{specialCaseOfExistence}
It is enough to prove theorem (\ref{AltmanKelimanEasy}) in the case where $X=\Pj^n_\K$ and $\Ec=\Oc_{\Pj^n_\K}^p$.
\end{proposition}


\begin{lemma}\label{NoTwistLemma}
If $\nu$ is an integer then 
\[\quotf^{\Phi,\Lc}_{\Ec/X/\K}\cong \quotf^{\Phi(\la+\nu),\Lc}_{\Ec(\nu)/X/\K}.\]
\end{lemma}
\begin{proof}
The isomorphism is given by tensoring everything with $\Lc^{\otimes \nu}$. Indeed $\Ec\otimes \Lc^{\otimes \nu}$ is the definition of $\Ec(\nu)$, $\chi(\Fc\otimes \Lc^{\otimes m+\nu})=\chi((\Fc\otimes\Lc^{\otimes \nu})\otimes \Lc^{\otimes m})$ and tensoring with a line bundle does nothing to surjectivity, flatness or properness of support.
\end{proof}

\begin{lemma}\label{NoQuotientLemma}
Let $\phi:\Ec\to\Gc$ be a surjective morphism of coherent sheaves on $X$, then this morphism induces a natural transformation \[\quotf^{\Phi,\Lc}_{\Gc/X/\K}\to \quotf^{\Phi,\Lc}_{\Ec/X/\K}\]
which is a closed immersion.
\end{lemma}
\begin{proof}
This is part of lemma 5.17, page 127 in \cite{FGAEXPLAINED}.
%The natural transformation is the one induced by pullback via $\phi$. What we want to show is that, given any locally noetherian $\K$-scheme $T$ and a family $[q:\Ec_T\to \Fc]\in \quotf^{\Phi,\Lc}_{\Ec/X/\K}$ (which by Yoneda induces a morphism $h_T\to \quotf^{\Phi,\Lc}_{\Ec/X/\K}$), there exists a closed subscheme $T'\subseteq T$ such that we have a cartesian square
% https://q.uiver.app/#q=WzAsNCxbMSwxLCJcXHF1b3RmXntcXFBoaSxcXExjfV97XFxFYy9YL1xcS30iXSxbMCwxLCJcXHF1b3RmXntcXFBoaSxcXExjfV97XFxHYy9YL1xcS30iXSxbMSwwLCJoX1QiXSxbMCwwLCJoX3tUJ30iXSxbMSwwXSxbMiwwXSxbMywyLCIiLDIseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbMywxLCIiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19XSxbMyw0LCIiLDAseyJsZXZlbCI6MSwic3R5bGUiOnsibmFtZSI6ImNvcm5lci1pbnZlcnNlIn19XV0=
%\[\begin{tikzcd}
%	{h_{T'}} & {h_T} \\
%	{\quotf^{\Phi,\Lc}_{\Gc/X/\K}} & {\quotf^{\Phi,\Lc}_{\Ec/X/\K}}
%	\arrow[dashed, from=1-1, to=1-2]
%	\arrow[dashed, from=1-1, to=2-1]
%	\arrow[from=1-2, to=2-2]
%	\arrow[""{name=0, anchor=center, inner sep=0}, from=2-1, to=2-2]
%	\arrow["\ulcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=0]
%\end{tikzcd}\]
%We define $T'$ to be the zero locus of the composite map $\ker(\phi_T)\to \Ec_T\to \Fc$.
\end{proof}


\begin{proof}[Proof of Proposition (\ref{specialCaseOfExistence})]
By applying lemma (\ref{NoTwistLemma}) we have
\[\quotf^{\Phi,\Lc}_{\Oc_{\Pj^n_\K}(\nu)^p/\Pj^n_\K/\K}\cong \quotf^{\Phi(\la-\nu),\Lc}_{\Oc_{\Pj^n_\K}^p/\Pj^n_\K/\K}.\]
Observe now that, since $X\subseteq \Pj^n_\K$ is a closed subscheme, $\Oc_X$ is a quotient of $\Oc_{\Pj^n_\K}$. We thus obtain a surjective morphism of coherent sheaves
\[\Oc_{\Pj^n_\K}(\nu)^p\to \Oc_X(\nu)^p\to \Ec,\]
which by lemma (\ref{NoQuotientLemma}) yields a chain of closed immersions
\[\quotf^{\Phi,\Lc}_{\Ec/X/\K}\subseteq \quotf^{\Phi,\Lc}_{\Oc_X(\nu)^p/X/\K}\subseteq\quotf^{\Phi,\Lc}_{\Oc_{\Pj^n_\K}(\nu)^p/\Pj^n_\K/\K}.\]
Therefore, if we can construct $\Quot^{\Phi(\la-\nu),\Lc}_{\Oc^p_{\Pj^n_\K}/\Pj^n_\K/\K}$, we can take $\Quot^{\Phi,\Lc}_{\Ec/X/\K}$ to be an appropriate closed subscheme of it.
\end{proof}

\subsection{Embedding into a Grassmannian}
For simplicity of notation we set $\Ec=\Oc^p_{\Pj^n_\K}$. Recall that $\pi:\Pj^n_\K\to \Spec \K$ and $\pi_T:\Pj^n_T\to T$ are the structural morphisms.
\begin{lemma}\label{PushforwardEr}
The pushforward
$\pi_\ast\Ec(r)$ is a skyscraper sheaf with stalk $\K^p\otimes \Sym^r\K^{n+1}$.
\end{lemma}
\begin{proof}
Since $\Spec\K$ consists of a single point, $\pi_\ast\Ec(r)$ must be a skyscraper sheaf with stalk $\pi_\ast\Ec(r)(\Spec\K)=\Ec(r)(\Pj^n_\K)=\Gamma(\Pj^n_\K,\Ec(r))$. Since $\Lc=\Oc_{\Pj^n_\K}(1)$ we see that $\Ec(r)=\Oc_{\Pj^n_\K}^p\otimes_{\Oc_{\Pj^n_\K}}\Oc_{\Pj^n_\K}(r)$, so
\[\pi_\ast\Ec(r)(\Spec\K)=\Gamma(\Pj^n_\K,\Oc_{\Pj^n_\K}(r)^p)=(\Sym^r\K^{n+1})^p\cong \K^p\otimes\Sym^r\K^{n+1}.\]
\end{proof}

\begin{lemma}\label{HilbetPolynomialOfProjectiveSpace}
The Hilbert polynomial of $\Oc_{\Pj^n_\K}^p$ is the one determined by
\[r\mapsto p\binom{r+n}n,\]
in particular it depends only on $p$ and $n$.
\end{lemma}
\begin{proof}
For sufficiently large $r$ we have
\begin{align*}
\chi(\Oc_{\Pj^n_\K}(r)^p)=&p\chi(\Oc_{\Pj^n_\K}(r))=p\dim_\K H^0(\Pj^n_\K,\Oc_{\Pj^n_\K}(r))=\\
=&p\dim_\K \Sym^r \K^{n+1}=p\binom{r+n}n.
\end{align*}
\end{proof}


Let $T$ be a noetherian\footnote{we can suppose $T$ to be noetherian because all properties that we want to verify are local.} $\K$-scheme. The main idea for the proof of the representability of $\quotf$ is building a natural transformation of the form
\[\funcDef{\quotf^{\Phi,\Lc}_{\Ec/\Pj^n_\K/\K}(T)}{\gr(\Phi(r),\dim_\K\pi_\ast\Ec(r))(T)}{[\Ec_T\onto Q]}{[{\pi_T}_\ast\Ec_T(r)\to {\pi_T}_\ast Q(r)]}\]
for an appropriate integer $r$. We are identifying $\pi_\ast\Ec(r)$ with the vector space $\K^p\otimes\Sym^r\K^{n+1}$ as in the above lemma. We separate the proof into three steps:
\setlength{\leftmargini}{1.3cm}
\begin{enumerate}
\item[Step 1.] Find $m_0\in\Z$ such that if $r\geq m_0$ then the above map is well defined and natural.
\item[Step 2.] Show that if $r\geq m_0$ the map above is injective for all $T$.
\item[Step 3.] Show that if $r\geq m_0$ the natural transformation above is a locally closed immersion.
\end{enumerate}
\setlength{\leftmargini}{0.5cm}
Since the Grassmannian functor is representable (\ref{GrassmannianIsModuliSpace}), the last step shows that a locally closed subscheme of $\Gr\pa{\Phi(r), \dim_\K\pi_\ast\Ec(r)}$ is a fine moduli space for $\quotf^{\Phi,\Lc}_{\Oc^p_{\Pj^n_\K}/\Pj^n_\K/\K}$.


\begin{proof}[Proof.(Step 1)]
We want to use the first claim of proposition (\ref{RegularityInFamilies}) to show that ${\pi_T}_\ast\Ec_T(r)$ and ${\pi_T}_\ast Q(r)$ are vector bundles which behave well with respect to pullbacks for $r$ greater then some positive integer $m_0$. So what we seek to show is that there exists a number $m_0>0$ such that for all $t\in T$, $\Ec_T\res{\Pj^n_{k(t)}}$ and $Q\res{\Pj^n_{k(t)}}$ are $m_0$-regular. 

By the nature of proposition (\ref{RegularityInFamilies}) and given that $T$ is a $\K$-scheme, the desired result for $\Ec_T$ follows if we prove it for $T=\Spec\K$.
Since $\Spec \K$ consists of only one point, there is only one fiber to consider for the restrictions of $\Ec$: the whole of $\Pj^n_\K$. Let $m$ be the integer given by Mumford's theorem (\ref{MumfordTheorem}) applied to $\Ec$. The proposition shows that if $r\geq m$ then $\pi_\ast\Ec(r)=\Oc_\K^p\otimes\Sym^r\Oc_\K^{n+1}$ is a vector bundle which commutes with base change. Changing the basis to $T$ yields the result we wanted on ${\pi_T}_\ast\Ec_T(r)$.

Let $q:\Ec_T\onto Q$ be a quotient on $\Pj^n_T$ with Hilbert polynomial $\Phi$ on each fiber. If we denote by $q_t$ its restriction to the fiber of $t\in T$ and define $\Kc=\ker q_t$, we see that $\Kc$ is a subsheaf of $\Ec_{k(t)}=\Oc_{\Pj^n_{k(t)}}^p$ whose Hilbert polynomial is determined\footnote{This is a consequence of the additivity of the Euler characteristic on exact sequences.} by $\Phi$ and the Hilbert polynomial of $\Oc_{\Pj^n_{k(t)}}^p$, which by lemma (\ref{HilbetPolynomialOfProjectiveSpace}) does not depend on $t$. By Mumford's theorem (\ref{MumfordTheorem}) there exists an integer $m_0$ which depends only on $n,\ p$ and $\Phi$ such that $\Kc$ is $m_0$-regular. Without loss of generality we may take $m_0\geq m$ by applying corollary (\ref{RegularityUnboundedAbove}). Because of lemma (\ref{RegularityOnExactSequences}), we see that $Q$ too is $m_0$-regular on each fiber. Since $\Ec_T$ and $Q$ are flat over $T$, $\Kc$ is also flat over $T$ by properties of short exact sequences. 

Putting all of this together, we may apply proposition (\ref{RegularityInFamilies}) to see that ${\pi_T}_\ast Q(r)$ and ${\pi_T}_\ast\Kc$ are vector bundles which behave well with pullbacks and that $R^1{\pi_T}_\ast \Kc(r)=0$. 
By looking at the long exact sequence of higher direct images induced by
\[0\to\Kc(r)\to\Ec_T(r)\to Q(r)\to 0\]
together with the fact that $R^1{\pi_T}_\ast \Kc(r)=0$, we see that ${\pi_T}_\ast\Ec_T(r)\to{\pi_T}_\ast Q(r)$ is surjective. To conclude the proof we just need to observe that ${\pi_T}_\ast Q(r)$ is of fixed rank $\Phi(r)$. Note that ${\pi_T}_\ast Q(r)_t=Q\res{\Pj^n_{k(t)}}(r)$, which has Hilbert polynomial $\Phi$, so the desired result follows easily from the definition of Hilbert polynomial and statement (c) of lemma (\ref{CastelnuovoLemma}).
\end{proof}

\begin{proof}[Proof. (Step 2)]
Let $q:\Ec_T\to Q$ be a quotient sheaf which is flat over $T$ and let $\Kc=\ker q$. Note that $\Kc$ too is flat over $T$. If we choose $m_0$ like in the proof of Step 1 we get the following commutative diagram
% https://q.uiver.app/#q=WzAsMTAsWzAsMCwiMCJdLFsxLDAsIntcXHBpX1R9XlxcYXN0e1xccGlfVH1fXFxhc3QoXFxLYyhyKSkiXSxbMiwwLCJ7XFxwaV9UfV5cXGFzdHtcXHBpX1R9X1xcYXN0KFxcRWNfVChyKSkiXSxbMywwLCJ7XFxwaV9UfV5cXGFzdHtcXHBpX1R9X1xcYXN0KFEocikpIl0sWzAsMSwiMCJdLFsxLDEsIlxcS2MocikiXSxbMiwxLCJcXEVjX1QocikiXSxbMywxLCJRKHIpIl0sWzQsMCwiMCJdLFs0LDEsIjAiXSxbMyw4XSxbNyw5XSxbMiwzXSxbNiw3XSxbNCw1XSxbNSw2XSxbMSwyXSxbMCwxXSxbMyw3XSxbMiw2XSxbMSw1XV0=
\[\begin{tikzcd}
	0 & {{\pi_T}^\ast{\pi_T}_\ast(\Kc(r))} & {{\pi_T}^\ast{\pi_T}_\ast(\Ec_T(r))} & {{\pi_T}^\ast{\pi_T}_\ast(Q(r))} & 0 \\
	0 & {\Kc(r)} & {\Ec_T(r)} & {Q(r)} & 0
	\arrow[from=1-1, to=1-2]
	\arrow[from=1-2, to=1-3]
	\arrow[from=1-2, to=2-2]
	\arrow[from=1-3, to=1-4]
	\arrow[from=1-3, to=2-3]
	\arrow[from=1-4, to=1-5]
	\arrow[from=1-4, to=2-4]
	\arrow[from=2-1, to=2-2]
	\arrow[from=2-2, to=2-3]
	\arrow[from=2-3, to=2-4]
	\arrow[from=2-4, to=2-5]
\end{tikzcd}\]
where the rows are exact and the vertical maps are surjective by the last statement in proposition (\ref{RegularityInFamilies}). Let $\al$ be given by the composition 
\[{\pi_T}^\ast{\pi_T}_\ast(\Kc(r))\to \Kc(r)\to \Ec_T(r).\]
Because of the surjectivity of the vertical map, $\imm\al=\Kc(r)\subseteq \Ec_T(r)$, so $Q(r)=\coker\al$.

By commutativity, $\al$ can also be written as the composition
\[{\pi_T}^\ast{\pi_T}_\ast(\Kc(r))\to {\pi_T}^\ast{\pi_T}_\ast(\Ec_T(r))\to \Ec_T(r)\] 
and in this form it is clear that ${\pi_T}_\ast(\Ec_T(r))\to {\pi_T}_\ast(Q(r))$ uniquely determines $\al$ and thus the cokernel $\Ec_T(r)\to Q(r)$. This construction behaves well with changing representatives for the quotients.
\end{proof}

\begin{proof}[Proof.(Step 3)]
Let $h_\tau:h_T\to \Gr(\Phi(r),\pi_\ast\Ec(r))$ be the natural transformation which corresponds to the quotient $[q:{\pi_T}_\ast\Ec_T(r)\onto V]$ via the Yoneda lemma (\ref{YonedaLemma}) and let $\Kc=\ker q$. Let us consider the fiber product
% https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXEhmX3EiXSxbMSwwLCJoX1QiXSxbMCwxLCJcXHF1b3RmXntcXFBoaSxcXExjfV97XFxFYy9cXFBqXm5fXFxLL1xcS30iXSxbMSwxLCJcXGdyKFxcUGhpKHIpLFxcZGltX1xcS1xccGlfXFxhc3RcXEVjKHIpKSJdLFswLDEsIiIsMCx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFsyLDMsIiIsMCx7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Imhvb2siLCJzaWRlIjoidG9wIn19fV0sWzEsMywiaF9cXHRhdSJdLFswLDIsIiIsMCx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dLFswLDUsIiIsMix7ImxldmVsIjoxLCJzdHlsZSI6eyJuYW1lIjoiY29ybmVyLWludmVyc2UifX1dXQ==
\[\begin{tikzcd}
	{\Hf_q} & {h_T} \\
	{\quotf^{\Phi,\Lc}_{\Ec/\Pj^n_\K/\K}} & {\gr(\Phi(r),\dim_\K\pi_\ast\Ec(r))}
	\arrow[dashed, from=1-1, to=1-2]
	\arrow[dashed, from=1-1, to=2-1]
	\arrow["{h_\tau}", from=1-2, to=2-2]
	\arrow[""{name=0, anchor=center, inner sep=0}, hook, from=2-1, to=2-2]
	\arrow["\ulcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=0]
\end{tikzcd}\]
We seek to show that $\Hf_q$ is representable by a locally closed subscheme of $T$ in such a way as to make the upper horizontal map of the cartesian square the one induced by inclusion. Note that because of the injectivity of the bottom morphism of presheaves we have that the upper horizontal map is always injective. 

Let us consider this version of the diagram from the previous proof
% https://q.uiver.app/#q=WzAsOCxbMCwwLCIwIl0sWzEsMCwie1xccGlfVH1eXFxhc3RcXEtjIl0sWzIsMCwie1xccGlfVH1eXFxhc3R7XFxwaV9UfV9cXGFzdChcXEVjX1QocikpIl0sWzMsMCwie1xccGlfVH1eXFxhc3QgViJdLFsyLDEsIlxcRWNfVChyKSJdLFszLDEsIlEocikiXSxbNCwwLCIwIl0sWzQsMSwiMCJdLFszLDZdLFs1LDddLFsyLDNdLFs0LDVdLFsxLDJdLFswLDFdLFszLDVdLFsyLDRdLFsxLDQsIlxcYWwiLDJdXQ==
\[\begin{tikzcd}
	0 & {{\pi_T}^\ast\Kc} & {{\pi_T}^\ast{\pi_T}_\ast(\Ec_T(r))} & {{\pi_T}^\ast V} & 0 \\
	&& {\Ec_T(r)} & {Q(r)} & 0
	\arrow[from=1-1, to=1-2]
	\arrow[from=1-2, to=1-3]
	\arrow["\al"', from=1-2, to=2-3]
	\arrow[from=1-3, to=1-4]
	\arrow[from=1-3, to=2-3]
	\arrow[from=1-4, to=1-5]
	\arrow[from=1-4, to=2-4]
	\arrow[from=2-3, to=2-4]
	\arrow[from=2-4, to=2-5]
\end{tikzcd}\]
where $Q=(\coker(\al))(-r)$. Since the objects on the top row are pullbacks of vector bundles we see that ${\pi_T}_\ast\al$ corresponds to the inclusion $\Kc\subseteq {\pi_T}_\ast\Ec_T(r)$ up to identifying ${\pi_T}_\ast{\pi_T}^\ast\Kc$ and $\Kc$. It follows by the definition of $\Kc$ then that ${\pi_T}_\ast Q(r)$ can be identified with $V$.

Observe that, if $Q$ if flat over $T$ with Hilbert polynomial $\Phi$, then $[\Ec_T\to Q]\in \quotf^{\Phi,\Lc}_{\Ec/\Pj^n_\K/\K}(T)$. By Yoneda's lemma (\ref{YonedaLemma}), this yields a natural transformation $\eta$ which provides a lift of $h_\tau$, i.e.
% https://q.uiver.app/#q=WzAsMyxbMCwxLCJoX1QiXSxbMSwxLCJcXGdyKFxcUGhpKHIpLFxcZGltX1xcS1xccGlfXFxhc3RcXEVjKHIpKSJdLFsxLDAsIlxccXVvdGZee1xcUGhpLFxcTGN9X3tcXEVjL1xcUGpebl9cXEsvXFxLfSJdLFswLDEsImhfXFx0YXUiLDJdLFswLDIsIlxcZXRhIiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fV0sWzIsMV1d
\[\begin{tikzcd}
	& {\quotf^{\Phi,\Lc}_{\Ec/\Pj^n_\K/\K}} \\
	{h_T} & {\gr(\Phi(r),\dim_\K\pi_\ast\Ec(r))}
	\arrow[from=1-2, to=2-2]
	\arrow["\eta", dashed, from=2-1, to=1-2]
	\arrow["{h_\tau}"', from=2-1, to=2-2]
\end{tikzcd}\]
Since $\Hf_q\to h_T$ is injective and we have a morphism $\eta:h_T\to \quotf^{\Phi,\Lc}_{\Ec/\Pj^n_\K/\K}$ which commutes with the maps to the Grassmannian, it easy to check set-theoretically by evaluating the functors on an arbitrary scheme that $\Hf_q\to h_T$ is an isomorphism. 

Conversely, if $Q$ does not have Hilbert polynomial $\Phi$ or is not flat over $T$ we cannot have factorization by definition of the functor of quotients. We have thus identified $\Hf_q$ with the following subfunctor of $h_T$
\[\funcDef{\Sch T}{\Set}{f:T'\to T}{\begin{cases}
\cpa{f} &\text{if $Q_{T'}$ is flat over $T'$ and has Hilbert polynomial $\Phi$}
\\
\emptyset &\text{otherwise}
\end{cases}}\]
By the theorem on flattening stratifications (\ref{FlatetningStratifications}) this shows that $\Hf_q\cong h_{T_\Phi}$ via an isomorphism which is compatible with the inclusion map.
\end{proof}